<script>
  jQuery(document).ready(function ($) {

    $(".map-loading").hide();
    $('.map-complete').hide();

    $(".generateBtn").on("click", function (e) {
      e.preventDefault();


      $('.map-complete').hide();

      // Hide Preview
      $(".map-preview").hide()

      // Show loading indicator
      $(".map-loading").show();

      $.ajax({
        url: infinity_vars.ajaxurl,
        type: "POST",
        data: {
          action: "download_file",
          security: infinity_vars.security,
        },
        success: function (response) {
          // Create a blob from the response
          var blob = new Blob([response], { type: "image/jpeg" }); // Adjust type as needed
          var url = URL.createObjectURL(blob);

          // hide loading indicator
          $(".map-loading").hide();

          // Display the image
          $("#generatedMap").attr("src", url)

          $('.map-complete').show();
        },
        error: function (xhr, status, error) {
          console.error("AJAX error:", error);
          alert("An error occurred.");
        },
        xhrFields: {
          responseType: "blob", // Important to handle binary data correctly
        },
      });
    });
  });
</script>